"use strict";var To=Object.create;var H=Object.defineProperty;var Eo=Object.getOwnPropertyDescriptor;var Uo=Object.getOwnPropertyNames;var Fo=Object.getPrototypeOf,Do=Object.prototype.hasOwnProperty;var Mo=(o,e)=>{for(var t in e)H(o,t,{get:e[t],enumerable:!0})},lo=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Uo(e))!Do.call(o,n)&&n!==t&&H(o,n,{get:()=>e[n],enumerable:!(r=Eo(e,n))||r.enumerable});return o};var C=(o,e,t)=>(t=o!=null?To(Fo(o)):{},lo(e||!o||!o.__esModule?H(t,"default",{value:o,enumerable:!0}):t,o)),Lo=o=>lo(H({},"__esModule",{value:!0}),o);var Ae={};Mo(Ae,{Component:()=>Ao,plugin:()=>Q});module.exports=Lo(Ae);var D=require("flipper");var _=require("react"),mo=(o,e)=>{let[t,r]=(0,_.useState)(0),n=i=>{switch(i.key){case"ArrowDown":{let a=t<o.length-1?t+1:o.length-1;r(a),e(o[a].uri);break}case"ArrowUp":{let a=t>0?t-1:t;r(a),e(o[a].uri);break}default:{r(0);break}}};return(0,_.useEffect)(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)})),t};var uo=o=>{let e={icon:"bookmark",matchPatterns:new Map};return o.forEach((t,r)=>{let n=t.commonName+" - "+r;e.matchPatterns.set(n,r)}),e},po=o=>{let e={icon:"mobile",matchPatterns:new Map};return o.forEach(t=>{let r=t.className+" - "+t.pattern;e.matchPatterns.set(r,t.pattern)}),e},Oo=(o,e,t)=>{let r=new Map;for(let[n,i]of o){if(r.size>=t)break;n.toLowerCase().includes(e.toLowerCase())&&r.set(n,i)}return r},Ro=(o,e,t)=>({...o,matchPatterns:Oo(o.matchPatterns,e,t)}),co=(o,e,t)=>{let r=t,n=new Array(0);for(let i of o){let a=Ro(i,e,r);a.matchPatterns.forEach((m,l)=>{n.push({icon:i.icon,matchPattern:l,uri:m})}),r-=a.matchPatterns.size}return n};var q=C(require("react")),qo=5,zo=D.styled.div({width:"100%",position:"absolute",top:"calc(100% - 3px)",backgroundColor:"white",zIndex:1,borderBottomRightRadius:10,borderBottomLeftRadius:10,boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"}),Vo=D.styled.div({padding:5,textOverflow:"ellipsis",overflowX:"hidden",whiteSpace:"nowrap","&.selected":{backgroundColor:"rgba(155, 155, 155, 0.2)"},"&:hover":{backgroundColor:"rgba(155, 155, 155, 0.2)"}}),Ho=D.styled.span({padding:8});function J(o){let{providers:e,onHighlighted:t,onNavigate:r,query:n}=o,i=co(e,n,qo);i.unshift({uri:n,matchPattern:n,icon:"send"});let a=mo(i,t);return q.default.createElement(zo,null,i.map((m,l)=>q.default.createElement(Vo,{className:l===a?"selected":"",key:l,onMouseDown:()=>r(m.uri)},q.default.createElement(Ho,null,q.default.createElement(D.Glyph,{name:m.icon,size:16,variant:"outline"})),m.matchPattern)))}var c=require("flipper");var B=C(require("react")),E=require("flipper-plugin"),_o=(0,c.styled)(c.FlexCenter)({fontSize:18,color:E.theme.textColorSecondary}),jo=c.styled.div({overflowY:"scroll",overflowX:"hidden",height:"100%",backgroundColor:E.theme.backgroundDefault}),Go=(0,c.styled)(c.FlexRow)({width:"100%",padding:10,height:55,alignItems:"center",cursor:"pointer",borderBottom:`1px ${E.theme.dividerColor} solid`,":last-child":{borderBottom:"0"},":active":{backgroundColor:E.theme.backgroundWash}}),Wo=(0,c.styled)(c.Text)({fontSize:"1.1em",overflowX:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontWeight:500}),Ko=(0,c.styled)(c.Text)({overflowX:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",color:E.theme.textColorSecondary,marginTop:4}),$o=(0,c.styled)(c.FlexColumn)({justifyContent:"center"}),Xo=(o,e)=>o.uri<e.uri?-1:o.uri>e.uri?1:0;function Y(o){let{bookmarks:e,onNavigate:t,onRemove:r}=o;return B.default.createElement(c.DetailSidebar,null,B.default.createElement(c.Panel,{heading:"Bookmarks",floating:!1,padded:!1},e.size===0?B.default.createElement(_o,{grow:!0},"No Bookmarks"):B.default.createElement(jo,null,[...e.values()].sort(Xo).map((n,i)=>B.default.createElement(Go,{key:i,role:"button",tabIndex:0,onClick:()=>{t(n.uri)}},B.default.createElement($o,{grow:!0},B.default.createElement(Wo,null,n.commonName||n.uri),!n.commonName&&B.default.createElement(Ko,null,n.uri)),B.default.createElement(N,{color:E.theme.textColorSecondary,outline:!1,icon:"cross-circle",size:16,onClick:()=>r(n.uri)}))))))}var G=require("flipper");var j=C(require("react")),Qo=G.styled.div({position:"relative",">:first-child":{position:"absolute"},">:last-child":{position:"relative"}});function Z(o){let{highlighted:e,onClick:t,...r}=o;return j.default.createElement(Qo,null,e?j.default.createElement(N,{outline:!1,color:G.colors.lemon,icon:"star",...r}):null,j.default.createElement(N,{outline:!0,icon:"star",onClick:t,...r}))}var U=require("flipper"),W=C(require("react")),Jo=(0,U.keyframes)({"0%":{transform:"scale(1);"},"100%":{transform:"scale(.9)"}}),Yo=U.styled.div({padding:5,borderRadius:100,backgroundPosition:"center",transition:"background 0.5s",":hover":{background:"rgba(155, 155, 155, 0.2) radial-gradient(circle, transparent 1%, rgba(155, 155, 155, 0.2) 1%) center/15000%"},":active":{backgroundColor:"rgba(201, 200, 200, 0.5)",backgroundSize:"100%",transition:"background 0s"}}),Zo=U.styled.div({":active":{animation:`${Jo} .25s ease forwards`}});function N(o){return W.default.createElement(Yo,null,W.default.createElement(Zo,{className:"icon-button",onClick:o.onClick},W.default.createElement(U.Glyph,{name:o.icon,size:o.size,color:o.color,variant:o.outline?"outline":"filled"})))}var s=require("flipper");var z=(o,e)=>o&&(oo(e)?!isNaN(parseInt(o,10)):!0)&&(eo(e)?o==="true"||o==="false":!0),K=o=>o.replace(/[/&]?([^&?={}\/]*=)?{\?.*?}/g,""),go=o=>{let e=o.split("?").splice(1).join(""),t=new URLSearchParams(e),r=new Map;for(let n in t)r.set(n,t.get(n));return r},oo=o=>/^{(#|\?#)/g.test(o),eo=o=>/^{(!|\?!)/g.test(o),vo=(o,e)=>{let t=/{[^?]*?}/g,r=/{[^?]*?}/,n=o,i=0,a=t.exec(o);for(;a!=null;)n=n.replace(r,e[i]),a=t.exec(o),i++;return n},ho=o=>{let e=/={[^?]*?}/g,t=[],r=e.exec(o);for(;r!=null;){if(r[0]){let n=r[0].substring(1);try{JSON.parse(n)}catch{t.push(n)}}r=e.exec(o)}return t},ko=(o,e)=>{let t=/({[^?]*?})/g;return o.split(t).reduce((n,i,a)=>a%2===0||!e[(a-1)/2]?n+i:n+e[(a-1)/2])},fo=o=>o.replace(/\?.*$/g,"");var u=C(require("react")),$=require("flipper-plugin"),oe=240,ee=s.styled.div({width:200,minWidth:200,overflow:"hidden",borderLeft:`1px ${s.colors.blueGrayTint90} solid`,position:"relative",height:"100%",borderRadius:10,img:{width:"100%"}}),te=s.styled.div({color:s.colors.light30,fontSize:14,position:"relative"}),re=s.styled.div({alignItems:"flex-start",flexGrow:1,position:"relative"}),ne=s.styled.div({width:"100%",padding:"10px",borderTop:`1px ${s.colors.blueGrayTint90} solid`,display:"flex",alignItems:"center"}),bo=s.styled.div({flexGrow:1}),ae=s.styled.div({color:s.colors.light30,fontSize:14}),ie=s.styled.div({display:"flex",height:oe,borderRadius:10,flexGrow:1,position:"relative",marginBottom:10,backgroundColor:$.theme.backgroundDefault,boxShadow:"1px 1px 5px rgba(0,0,0,0.1)"}),se=s.styled.div({fontSize:18,fontWeight:500,userSelect:"text",cursor:"text",padding:10,borderBottom:`1px ${s.colors.blueGrayTint90} solid`,display:"flex"}),le=s.styled.div({color:s.colors.light30}),me=s.styled.div({height:150,"&>*":{height:150,marginBottom:20}}),ue=(0,s.styled)(s.FlexCenter)({fontSize:18,color:s.colors.light10}),pe=s.styled.div({width:18,height:18,top:11,left:-33,backgroundColor:$.theme.backgroundWash,border:`4px solid ${s.colors.highlight}`,borderRadius:"50%",position:"absolute"}),ce=s.styled.div({width:12,height:12,top:1,left:-30,borderRadius:"50%",backgroundColor:$.theme.textColorActive,position:"absolute"}),de=o=>{let e=[],t=0;return o.forEach((r,n)=>{e.push({key:t.toString(),columns:{parameter:{value:n},value:{value:r}}}),t++}),u.default.createElement(s.ManagedTable,{columns:{parameter:{value:"Parameter"},value:{value:"Value"}},rows:e,zebra:!1})};function to(o){let{uri:e,isBookmarked:t,className:r,screenshot:n,onNavigate:i,onFavorite:a,date:m}=o;if(e==null&&r==null)return u.default.createElement(u.default.Fragment,null,u.default.createElement(te,null,u.default.createElement(ce,null),"Unknown Navigation Event"));{let l=e!=null?go(e):null;return u.default.createElement(ie,null,u.default.createElement(pe,null),u.default.createElement(re,null,u.default.createElement(se,null,e!=null?fo(e):"",u.default.createElement(bo,null),r!=null?u.default.createElement(u.default.Fragment,null,u.default.createElement(s.Glyph,{color:s.colors.light30,size:16,name:"paper-fold-text"}),"\xA0",u.default.createElement(le,null,r??"")):null),u.default.createElement(me,null,l!=null&&l.size>0?de(l):u.default.createElement(ue,{grow:!0},"No Parameters for this Event")),u.default.createElement(ne,null,e!=null?u.default.createElement(u.default.Fragment,null,u.default.createElement(s.Button,{onClick:()=>i(e)},"Open"),u.default.createElement(s.Button,{onClick:()=>a(e)},t?"Edit Bookmark":"Bookmark")):null,u.default.createElement(bo,null),u.default.createElement(ae,null,m!=null?m.toTimeString():""))),e!=null||r!=null?u.default.createElement(ee,null,n!=null?u.default.createElement("img",{src:n}):u.default.createElement(s.FlexCenter,{grow:!0},u.default.createElement(s.LoadingIndicator,{size:32}))):null)}}var k=require("antd"),Io=require("flipper-plugin");var X=require("react");var Co=o=>{let[e,t]=(0,X.useState)(o.map(()=>""));return{isValid:(0,X.useMemo)(()=>(o.length!=e.length&&t(o.map(()=>"")),!!e.every((n,i)=>z(n,o[i]))),[o,e]),values:e,setValuesArray:t}};var h=C(require("react"));function ro(o){let{onHide:e,onSubmit:t,uri:r,requiredParameters:n}=o,{isValid:i,values:a,setValuesArray:m}=Co(n);return h.default.createElement(k.Modal,{open:!0,onCancel:e,title:"Provide bookmark details",footer:h.default.createElement(h.default.Fragment,null,h.default.createElement(k.Button,{onClick:()=>{e(),m([])}},"Cancel"),h.default.createElement(k.Button,{type:"primary",onClick:()=>{t(vo(r,a)),e()},disabled:!i},"Submit"))},h.default.createElement(Io.Layout.Container,{gap:!0},h.default.createElement(k.Alert,{type:"info",message:"This uri has required parameters denoted by '{parameter}'}."}),n.map((l,v)=>h.default.createElement("div",{key:v},h.default.createElement(k.Input,{onChange:L=>m([...a.slice(0,v),L.target.value,...a.slice(v+1)]),name:l,placeholder:l}),a[v]&&oo(l)&&!z(a[v],l)?h.default.createElement(k.Alert,{type:"error",message:"Parameter must be a number"}):null,a[v]&&eo(l)&&!z(a[v],l)?h.default.createElement(k.Alert,{type:"error",message:"Parameter must be either 'true' or 'false'"}):null)),h.default.createElement(k.Typography.Text,{code:!0},ko(r,a))))}var Po=require("antd"),g=require("flipper"),f=C(require("react")),ge=(0,g.styled)(g.FlexColumn)({padding:10,width:400}),ve=g.styled.div({fontWeight:500,marginTop:8,marginLeft:2,marginBottom:8}),he=g.styled.div({marginLeft:2,marginBottom:8,overflowWrap:"break-word"}),ke=g.styled.div({marginLeft:"auto"}),fe=(0,g.styled)(g.Input)({margin:0,marginBottom:10,height:30});function no(o){let{edit:e,shouldShow:t,onHide:r,onRemove:n,onSubmit:i,uri:a}=o,[m,l]=(0,f.useState)("");return a==null||!t?null:f.default.createElement(Po.Modal,{open:!0,footer:null,onCancel:r},v=>f.default.createElement(ge,null,f.default.createElement(ve,null,e?"Edit bookmark...":"Save to bookmarks..."),f.default.createElement(fe,{placeholder:"Name...",value:m,onChange:L=>l(L.target.value)}),f.default.createElement(he,null,a),f.default.createElement(ke,null,f.default.createElement(g.Button,{onClick:()=>{v(),l("")},compact:!0,padded:!0},"Cancel"),e?f.default.createElement(g.Button,{type:"danger",onClick:()=>{v(),n(a),l("")},compact:!0,padded:!0},"Remove"):null,f.default.createElement(g.Button,{type:"primary",onClick:()=>{v(),i({uri:a,commonName:m}),l("")},compact:!0,padded:!0},"Save"))))}var S=require("flipper");var b=C(require("react")),be=S.styled.div({display:"inline-flex",height:"16px",alignItems:"center","":{marginLeft:10,".icon-button":{height:16},"img,div":{verticalAlign:"top",alignItems:"none"}}}),Ce=S.styled.div({".drop-shadow":{boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"}}),Ie=S.styled.div({width:"100%",marginLeft:5,marginRight:9,position:"relative"}),M=class extends b.Component{constructor(){super(...arguments);this.state={inputFocused:!1,autoCompleteSheetOpen:!1,query:"",searchInputValue:"",prevURIFromAbove:""};this.favorite=t=>{this.props.onFavorite(t)};this.navigateTo=t=>{this.setState({query:t,searchInputValue:t}),this.props.onNavigate(t)};this.queryInputChanged=t=>{let r=t.target.value;this.setState({query:r,searchInputValue:r})}}render(){let{bookmarks:t,providers:r}=this.props,{autoCompleteSheetOpen:n,inputFocused:i,searchInputValue:a,query:m}=this.state;return b.default.createElement(Ce,null,b.default.createElement(S.Toolbar,null,b.default.createElement(S.SearchBox,{className:i?"drop-shadow":""},b.default.createElement(Ie,null,b.default.createElement(S.SearchInput,{value:a,onBlur:()=>this.setState({autoCompleteSheetOpen:!1,inputFocused:!1}),onFocus:l=>{l.target.select(),this.setState({autoCompleteSheetOpen:!0,inputFocused:!0})},onChange:this.queryInputChanged,onKeyPress:l=>{l.key==="Enter"&&(this.navigateTo(this.state.searchInputValue),l.target.blur())},placeholder:"Navigate To..."}),n&&m.length>0?b.default.createElement(J,{providers:r,onNavigate:this.navigateTo,onHighlighted:l=>this.setState({searchInputValue:l}),query:m}):null)),a.length>0?b.default.createElement(be,null,b.default.createElement(N,{icon:"send",size:16,outline:!0,onClick:()=>this.navigateTo(a)}),b.default.createElement(Z,{size:16,highlighted:t.has(a),onClick:()=>this.favorite(a)})):null))}};M.getDerivedStateFromProps=(t,r)=>{let{uriFromAbove:n}=t,{prevURIFromAbove:i}=r;return n!==i?{searchInputValue:n,query:n,prevURIFromAbove:n}:null};var x=C(require("react")),I=require("flipper-plugin"),Pe=I.styled.div({width:2,backgroundColor:I.theme.textColorActive,position:"absolute",top:38,bottom:0}),Be=I.styled.div({display:"flex",paddingTop:25,paddingLeft:25,marginRight:25});function ao(o){let{bookmarks:e,events:t,onNavigate:r,onFavorite:n}=o,i=(0,x.useRef)(null);return t.length===0?x.default.createElement(I.Layout.Container,{center:!0,grow:!0,style:{fontSize:18,backgroundColor:I.theme.backgroundWash,color:I.theme.textColorSecondary}},"No Navigation Events to Show"):x.default.createElement(I.Layout.ScrollContainer,{ref:i},x.default.createElement(I.Layout.Container,{grow:!0,style:{paddingBottom:25,paddingLeft:25}},x.default.createElement(Pe,null),t.map((a,m)=>x.default.createElement(Be,{key:m},x.default.createElement(to,{isBookmarked:a.uri!=null?e.has(a.uri):!1,className:a.className,uri:a.uri,onNavigate:l=>{i.current!=null&&i.current.scrollTo(0,0),r(l)},onFavorite:n,screenshot:a.screenshot,date:a.date})))))}var Se="flipper_navigation_plugin_db",ye=1,A="bookmarks",xe=o=>new Promise((e,t)=>{if(o.objectStoreNames.contains(A))e();else{let r=o.createObjectStore(A,{keyPath:"uri"});r.transaction.oncomplete=()=>e(),r.transaction.onerror=()=>t(r.transaction.error)}}),we=o=>Promise.all([xe(o)]),io=()=>new Promise((o,e)=>{let t=window.indexedDB.open(Se,ye);t.onupgradeneeded=()=>{let r=t.result;we(r).then(()=>o(r)).catch(e)},t.onerror=()=>e(t.error),t.onsuccess=()=>o(t.result)}),Bo=o=>new Promise((e,t)=>{io().then(r=>{let i=r.transaction(A,"readwrite").objectStore(A).put(o);i.onsuccess=()=>e(),i.onerror=()=>t(i.error)}).catch(t)}),So=()=>new Promise((o,e)=>{let t=new Map;io().then(r=>{let i=r.transaction(A).objectStore(A).openCursor();i.onsuccess=()=>{let a=i.result;if(a){let m=a.value;t.set(m.uri,m),a.continue()}else o(t)},i.onerror=()=>e(i.error)}).catch(e)}),yo=o=>new Promise((e,t)=>{io().then(r=>{let i=r.transaction(A,"readwrite").objectStore(A).delete(o);i.onsuccess=()=>e(),i.onerror=()=>t(i.error)}).catch(t)});var xo=require("flipper-plugin"),so=require("flipper-plugin"),Ne=o=>o==null?null:o.split("#")[0],wo=(o,e)=>new Promise(async(t,r)=>{let n=Ne(o);if(n==="Facebook"){let i;if(e.os==="Android")i="facebook-match-patterns-android.json";else if(e.os==="iOS")i="facebook-match-patterns-ios.json";else return;let a=xo.path.join((0,so.getFlipperLib)().paths.staticPath,"facebook",i),m=await(0,so.getFlipperLib)().remoteServerContext.fs.readFile(a);return JSON.parse(m)}else n!=null?(console.log("No rule for app "+n),t([])):r(new Error("selectedApp was null"))});var No=C(require("react")),w=require("flipper-plugin");function Q(o){let e=(0,w.createState)(new Map,{persist:"bookmarks"}),t=(0,w.createState)([],{persist:"navigationEvents"}),r=(0,w.createState)([],{persist:"appMatchPatterns"}),n=(0,w.createState)(""),i=(0,w.createState)(!1),a=(0,w.createState)(null);o.onMessage("nav_event",async p=>{let d={uri:p.uri===void 0?null:decodeURIComponent(p.uri),date:p.date?new Date(p.date):new Date,className:p.class===void 0?null:p.class,screenshot:null};d.uri&&n.set(d.uri),t.update(F=>{F.unshift(d)});let y=await o.device.screenshot();if(!y){console.warn("[navigation] Could not retrieve valid screenshot from the device.");return}let O=URL.createObjectURL(new Blob([y.buffer])),R=t.get().indexOf(d);R!==-1&&t.update(F=>{F[R].screenshot=O})}),wo(o.appId,o.device).then(p=>{r.set(p)}).catch(p=>{console.error("[Navigation] Failed to find appMatchPatterns",p)}),So().then(p=>{e.set(p)}).catch(p=>console.error("[navigation] readBookmarksFromDB failed:",p));function m(p){let d=K(p);n.set(d);let y=ho(d);y.length===0?o.appName==="Facebook"&&o.device.os==="iOS"?o.send("navigate_to",{url:K(d)}):o.device.navigateToLocation(K(d)):(0,w.renderReactRoot)(O=>No.default.createElement(ro,{onHide:O,uri:d,requiredParameters:y,onSubmit:m}))}function l(p){i.set(!0),a.set(p)}function v(p){let d={uri:p.uri,commonName:p.commonName};e.update(y=>{y.set(d.uri,d)}),Bo(d)}function L(p){e.update(d=>{d.delete(p)}),yo(p)}return{navigateTo:m,onFavorite:l,addBookmark:v,removeBookmark:L,bookmarks:e,saveBookmarkURI:a,shouldShowSaveBookmarkDialog:i,appMatchPatterns:r,navigationEvents:t,currentURI:n,getAutoCompleteAppMatchPatterns(p,d,y,O){let R=p.toLowerCase(),F=[];for(let V of y)if(!d.has(V.pattern)&&(V.className.toLowerCase().includes(R)||V.pattern.toLowerCase().includes(R))&&(F.push(V),--O<1))break;return F}}}var T=C(require("react")),P=require("flipper-plugin");function Ao(){let o=(0,P.usePlugin)(Q),e=(0,P.useValue)(o.bookmarks),t=(0,P.useValue)(o.appMatchPatterns),r=(0,P.useValue)(o.saveBookmarkURI),n=(0,P.useValue)(o.shouldShowSaveBookmarkDialog),i=(0,P.useValue)(o.currentURI),a=(0,P.useValue)(o.navigationEvents),m=(0,T.useMemo)(()=>[uo(e),po(t)],[e,t]);return T.default.createElement(P.Layout.Container,{grow:!0},T.default.createElement(M,{providers:m,bookmarks:e,onNavigate:o.navigateTo,onFavorite:o.onFavorite,uriFromAbove:i}),T.default.createElement(ao,{bookmarks:e,events:a,onNavigate:o.navigateTo,onFavorite:o.onFavorite}),T.default.createElement(Y,{bookmarks:e,onRemove:o.removeBookmark,onNavigate:o.navigateTo}),T.default.createElement(no,{shouldShow:n,uri:r,onHide:()=>{o.shouldShowSaveBookmarkDialog.set(!1)},edit:r!=null?e.has(r):!1,onSubmit:o.addBookmark,onRemove:o.removeBookmark}))}
