"use strict";var k=Object.create;var f=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var I=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},w=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of T(t))!z.call(e,i)&&i!==n&&f(e,i,{get:()=>t[i],enumerable:!(a=L(t,i))||a.enumerable});return e};var D=(e,t,n)=>(n=e!=null?k(M(e)):{},w(t||!e||!e.__esModule?f(n,"default",{value:e,enumerable:!0}):n,e)),B=e=>w(f({},"__esModule",{value:!0}),e);var J={};I(J,{Component:()=>F,devicePlugin:()=>P});module.exports=B(J);var o=require("flipper-plugin"),d=require("@ant-design/icons"),l=D(require("react")),y=require("antd");var c=require("flipper-plugin"),p=require("@ant-design/icons"),b=D(require("react")),C={fontSize:"16px"},u={...c.theme.monospace},m={verbose:{label:"Verbose",style:{...u,color:c.theme.textColorSecondary},enabled:!1},debug:{label:"Debug",style:{...u,color:c.theme.textColorSecondary},enabled:!0},info:{label:"Info",enabled:!0},warn:{label:"Warn",style:{...u,color:c.theme.warningColor},icon:b.default.createElement(p.WarningFilled,{style:C}),enabled:!0},error:{label:"Error",style:{...u,color:c.theme.errorColor},icon:b.default.createElement(p.CloseCircleFilled,{style:C}),enabled:!0},fatal:{label:"Fatal",style:{...u,background:c.theme.errorColor,color:c.theme.white},icon:b.default.createElement(p.CloseCircleFilled,{style:C}),enabled:!0}};function O(e){return[{key:"type",title:"",width:30,filters:Object.entries(m).map(([t,n])=>({label:n.label,value:t,enabled:n.enabled})),onRender(t){return t.count>1?l.default.createElement(y.Badge,{count:t.count,size:"small",style:{marginTop:4,color:o.theme.white,background:m[t.type]?.style?.color??o.theme.textColorSecondary}}):m[t.type]?.icon}},{key:"date",title:"Time",width:120},{key:"pid",title:"PID",width:60,visible:!0},{key:"tid",title:"TID",width:60,visible:!1},{key:"tag",title:"Tag",width:160},{key:"app",title:"App",width:160,visible:!1},{key:"message",title:"Message",wrap:!0,formatters:[o.DataFormatter.truncate(400),o.DataFormatter.prettyPrintJson,o.DataFormatter.linkify]}]}function A(e){return m[e.type]?.style??u}function P(e){let t=(0,o.createDataSource)([],{limit:2e5,persist:"logs"}),n=(0,o.createState)(!0),a=(0,l.createRef)();e.onDeepLink(r=>{typeof r=="string"&&setTimeout(()=>{let g=!1;t.view.output(0,t.view.size).forEach((s,x)=>{s.message.includes(r)&&(a.current?.selectItem(x,g),g=!0)})},500)}),e.addMenuEntry({action:"clear",handler:v,accelerator:"ctrl+l"},{action:"createPaste",handler:h},{action:"goToBottom",handler:E});let i;function S(){n.get()&&e.device.isConnected?(n.set(!1),i=e.onDeviceLogEntry(r=>{let g=t.size-1,s=t.get(g);s&&s.message===r.message&&s.tag===r.tag&&s.type===r.type?t.update(g,{...s,count:s.count+1}):t.append({...r,count:1})})):(i?.(),n.set(!0))}async function v(){e.device.connected.get()&&await e.device.clearLogs(),t.clear(),a.current?.clearSelection()}function h(){let r=a.current?.getSelectedItems();r?.length||(r=t.view.output(0,t.view.size)),r?.length&&e.createPaste(JSON.stringify(r,null,2))}function E(){a?.current?.selectItem(t.view.size-1)}return S(),{columns:O(e.device.os),isConnected:e.device.isConnected,isPaused:n,tableManagerRef:a,rows:t,clearLogs:v,resumePause:S}}function F(){let e=(0,o.usePlugin)(P),t=(0,o.useValue)(e.isPaused);return l.default.createElement(o.DataTable,{dataSource:e.rows,columns:e.columns,enableAutoScroll:!0,enableMultiPanels:!0,onRowStyle:A,enableHorizontalScroll:!1,extraActions:e.isConnected?l.default.createElement(l.default.Fragment,null,l.default.createElement(y.Button,{title:`Click to ${t?"resume":"pause"} the log stream`,danger:t,onClick:e.resumePause},t?l.default.createElement(d.PlayCircleOutlined,null):l.default.createElement(d.PauseCircleOutlined,null)),l.default.createElement(y.Button,{title:"Clear logs",onClick:e.clearLogs},l.default.createElement(d.DeleteOutlined,null))):void 0,tableManagerRef:e.tableManagerRef})}
